# Kotlin Exposed Serialized Relationships

### Serialize your Database relationships by selecting them and avoid cyclic relations 

KESR Works by generating DTO classes from your Database Entities using KSP as a compiler Plugin.
These classes then resolve the given relationship on the fly and evaluate them in the runtime.
The DTOs generated by the compiler are then accessible using the toModel() extension function on your entities.
Using the with() selector allows to specify which relationships should be resolved when serializing the models class.
> Actually the relationship will be evaluated, as soon as the responsible function is called

## Example

### User - Post - Comment example

<details>
    <summary>User.kt</summary>

    ```kotlin
    @Model
    class User(id: EntityID<Int>) : Entity<Int>(id) {
    companion object : EntityClass<Int, User>(Users)
    var name by Users.name
        @HasMany
        val posts by Post referrersOn Posts.user
    
        @HasMany
        val comments by Comment referrersOn Comments.user
    }            
    ```
</details>

<details>
    <summary>Post.kt</summary>

    ```kotlin
    @Model
    class Post(id: EntityID<Int>) : Entity<Int>(id) {
    companion object : EntityClass<Int, Post>(Posts)
        var content by Posts.content

        @BelongsTo
        var user by User referencedOn Posts.user
         
        @HasMany
        val comments by Comment referrersOn Comments.post
    }
    ```
</details>

<details>
    <summary>Comment.kt</summary>

    ```kotlin
    @Model
    class Comment(id: EntityID<Int>) : Entity<Int>(id) {
    companion object : EntityClass<Int, Comment>(Comments)
        var content by Comments.content

        @BelongsTo
        var post by Post referencedOn Comments.post
    
        @BelongsTo
        var user by User referencedOn Comments.user
    }
    ```
</details>

### Serialize Relationship
Easily serialize your relationship by using a DLS selector

```kotlin
user.toModel().with {
    posts {
        comments()
    }
    comments {
        post()
    }
}
```

